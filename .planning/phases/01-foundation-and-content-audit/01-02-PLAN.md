---
phase: 01-foundation-and-content-audit
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - .planning/phases/01-foundation-and-content-audit/AUDIT.md
  - public/_redirects
autonomous: false

requirements:
  - MIGR-01
  - MIGR-02
  - MIGR-03

must_haves:
  truths:
    - "Every URL on gaslightconversions.com is listed in AUDIT.md with its confirmed HTTP status"
    - "Every old HTML URL has a 301 redirect rule in public/_redirects pointing to the correct new URL"
    - "Every product page's photos and copy are reviewed and marked usable, needs-update, or must-replace in AUDIT.md"
    - "Domain registration expiry date is documented in AUDIT.md"
  artifacts:
    - path: ".planning/phases/01-foundation-and-content-audit/AUDIT.md"
      provides: "URL inventory, content quality audit, domain status"
      contains: "usable"
    - path: "public/_redirects"
      provides: "301 redirect rules for all old HTML URLs"
      contains: "/kits.html"
  key_links:
    - from: "AUDIT.md URL inventory"
      to: "public/_redirects"
      via: "every old URL in inventory maps to a redirect rule"
      pattern: "301"
    - from: "public/_redirects"
      to: "Netlify CDN"
      via: "Astro copies public/ to dist/ on build; Netlify reads _redirects from publish dir"
      pattern: "_redirects in dist/"
---

<objective>
Crawl gaslightconversions.com to inventory every URL, audit existing product photos and copy for quality, check domain registration status, and produce the `_redirects` file. This is the pre-build intelligence phase — no design or components begin until this picture is complete.

Purpose: MIGR-01 (URL inventory), MIGR-02 (redirect map), and MIGR-03 (content quality audit) must be done before Phase 2 design begins. The content audit determines how much new asset production is needed.
Output: `AUDIT.md` (URL inventory + content quality + domain status) and `public/_redirects` (draft 301 rules, inactive until DNS cutover).
</objective>

<execution_context>
@/Users/carolyn/.claude/get-shit-done/workflows/execute-plan.md
@/Users/carolyn/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-content-audit/01-CONTEXT.md
@.planning/phases/01-foundation-and-content-audit/01-RESEARCH.md
@.planning/phases/01-foundation-and-content-audit/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Crawl gaslightconversions.com and produce AUDIT.md</name>
  <files>
    .planning/phases/01-foundation-and-content-audit/AUDIT.md
  </files>
  <action>
Crawl the live site to confirm all URLs, extract image references and copy, check domain status, and produce a complete AUDIT.md document.

**Step 1 — Crawl all navigable HTML pages:**

Fetch each known URL and verify HTTP status. The research identified 10 pages; confirm each is reachable and check for any additional linked pages:

```bash
for url in \
  "https://www.gaslightconversions.com/" \
  "https://www.gaslightconversions.com/kits.html" \
  "https://www.gaslightconversions.com/bulbs.html" \
  "https://www.gaslightconversions.com/components.html" \
  "https://www.gaslightconversions.com/mail_order.html" \
  "https://www.gaslightconversions.com/benefits.html" \
  "https://www.gaslightconversions.com/guide.html" \
  "https://www.gaslightconversions.com/faq.html" \
  "https://www.gaslightconversions.com/sitemap.html" \
  "https://www.gaslightconversions.com/contact_us.html"; do
  status=$(curl -s -o /dev/null -w "%{http_code}" "$url")
  echo "$status $url"
done
```

Also check for any URLs linked from those pages not in the list above:
```bash
curl -s https://www.gaslightconversions.com/sitemap.html | grep -oE 'href="[^"]+"' | grep '\.html'
```

**Step 2 — Extract images from product pages:**

For each product page (kits.html, bulbs.html, components.html), extract all `<img>` src attributes:
```bash
for page in kits bulbs components; do
  echo "=== ${page}.html ==="
  curl -s "https://www.gaslightconversions.com/${page}.html" | grep -oE 'src="[^"]*\.(jpg|jpeg|png|gif|webp)"' | sed 's/src="//;s/"//'
done
```

For each image URL found, fetch its content-length as a proxy for resolution:
```bash
# For each image URL discovered:
curl -sI "https://www.gaslightconversions.com/[image-path]" | grep -i "content-length\|content-type"
```

**Step 3 — Extract page copy excerpts:**

For each product page, extract the main text content:
```bash
for page in kits bulbs components guide; do
  echo "=== ${page}.html ==="
  curl -s "https://www.gaslightconversions.com/${page}.html" | sed 's/<[^>]*>//g' | grep -v '^[[:space:]]*$' | head -20
done
```

**Step 4 — Domain status check:**

Attempt ICANN API lookup:
```bash
curl -s "https://lookup.icann.org/api/search?query=gaslightconversions.com&unicode=1" | python3 -m json.tool 2>/dev/null | grep -i "expiry\|registrar\|expiration" || echo "[TBD — visit https://lookup.icann.org manually and search gaslightconversions.com]"
```

If the ICANN API returns no useful data, record the field as `[TBD — check lookup.icann.org]` — the checkpoint task will prompt Carolyn to complete it.

**Step 5 — Write AUDIT.md:**

Create `.planning/phases/01-foundation-and-content-audit/AUDIT.md` with this structure (fill in all factual fields from the crawl data; leave Carolyn's quality status fields blank — those are filled at the checkpoint):

```markdown
# Gaslight Conversions — Site Audit

**Audited:** [date]
**Auditor:** Claude (automated crawl) + Carolyn (photo/copy quality review)

---

## Domain Status

| Field | Value |
|-------|-------|
| Domain | gaslightconversions.com |
| Registry Expiry Date | [from ICANN lookup, or TBD] |
| Registrar | [from ICANN lookup, or TBD] |
| Name Servers | [from ICANN lookup, or TBD] |
| Auto-renew | [unknown until Carolyn checks registrar login] |

**Action needed if expiry within 60 days of project completion:** Renew immediately.

---

## URL Inventory (MIGR-01)

| Old URL | HTTP Status | Page Purpose | Confirmed New URL |
|---------|-------------|-------------|-------------------|
| `/` | [status] | Home | `/` |
| `/kits.html` | [status] | Conversion kits catalog | `/products` |
| `/bulbs.html` | [status] | Replacement bulbs | `/products` |
| `/components.html` | [status] | Gaslight components | `/products` |
| `/mail_order.html` | [status] | Mail order form (being dropped) | `/products` |
| `/benefits.html` | [status] | Benefits page (v2 or drop) | `/` |
| `/guide.html` | [status] | Installation guides | `/install-guides` |
| `/faq.html` | [status] | FAQ | `/faq` |
| `/sitemap.html` | [status] | HTML sitemap (dropping) | `/` |
| `/contact_us.html` | [status] | Contact form | `/contact` |

**Additional URLs discovered in crawl (not in navigation):**
[list any extras found, or "None found"]

---

## Content Quality Audit (MIGR-03)

> Status values: `usable` | `needs-update` | `must-replace`
> Claude: fills photo URLs and file sizes. Carolyn: fills all Status columns at checkpoint.

### /kits.html — Conversion Kits

**Photos found:**
| Image URL | File Size | Status |
|-----------|-----------|--------|
| [img src] | [bytes] | [Carolyn fills at checkpoint] |

**Copy excerpt:**
> [first 3-5 meaningful sentences extracted from page]

**Copy status:** [Carolyn fills at checkpoint]

---

### /bulbs.html — Replacement Bulbs

**Photos found:**
| Image URL | File Size | Status |
|-----------|-----------|--------|
| [img src] | [bytes] | [Carolyn fills at checkpoint] |

**Copy excerpt:**
> [copy excerpt]

**Copy status:** [Carolyn fills at checkpoint]

---

### /components.html — Gaslight Components

**Photos found:**
| Image URL | File Size | Status |
|-----------|-----------|--------|
| [img src] | [bytes] | [Carolyn fills at checkpoint] |

**Copy excerpt:**
> [copy excerpt]

**Copy status:** [Carolyn fills at checkpoint]

---

### /guide.html — Installation Guide

**Copy excerpt:**
> [copy excerpt]

**Copy status:** [Carolyn fills at checkpoint]

---

## Redirect Map Summary (MIGR-02)

See `public/_redirects` for the full file. Decisions per CONTEXT.md:
- `/kits.html`, `/bulbs.html`, `/components.html`, `/mail_order.html` → `/products`
- `/guide.html` → `/install-guides`
- `/faq.html` → `/faq`
- `/contact_us.html` → `/contact`
- `/benefits.html` → `/` (v2 candidate, no v1 equivalent)
- `/sitemap.html` → `/` (HTML sitemap replaced by XML sitemap in Phase 5)
- `/index.html` → `/` (belt-and-suspenders)
```
  </action>
  <verify>
    <automated>test -f /Users/carolyn/Gaslight/.planning/phases/01-foundation-and-content-audit/AUDIT.md && grep -c "gaslightconversions.com" /Users/carolyn/Gaslight/.planning/phases/01-foundation-and-content-audit/AUDIT.md</automated>
    <manual>Confirm AUDIT.md exists and contains: URL inventory table with HTTP status codes, image URL rows for product pages, copy excerpts, and domain status section.</manual>
    <sampling_rate>run after this task completes, before Task 2</sampling_rate>
  </verify>
  <done>
    AUDIT.md exists with all 10 known URLs listed with confirmed HTTP status codes, image URLs and file sizes extracted from the three product pages, copy excerpts for kits/bulbs/components/guide pages, and domain status section populated (fields may be TBD for registrar-login data).
  </done>
</task>

<task type="auto">
  <name>Task 2: Write public/_redirects with all 301 redirect rules</name>
  <files>
    public/_redirects
  </files>
  <action>
Create `public/_redirects` in the Astro project. Astro copies everything in `public/` to `dist/` verbatim on build. Netlify reads `_redirects` from the publish directory (`dist/`). This file is DRAFTED now but does NOT go live until DNS cutover in Phase 5.

Write `public/_redirects` with the following content (source: CONTEXT.md decisions + RESEARCH.md code example):

```
# Gaslight Conversions — 301 Redirect Rules
# Source truth: .planning/phases/01-foundation-and-content-audit/AUDIT.md
# File location: public/_redirects (Astro copies to dist/ on build)
# STATUS: Draft — goes live at DNS cutover (Phase 5), not before
# Last updated: [date]

# --- Product pages (all map to catalog until individual pages exist in Phase 3) ---
/kits.html            /products           301
/bulbs.html           /products           301
/components.html      /products           301
/mail_order.html      /products           301

# --- Content pages ---
/guide.html           /install-guides     301
/faq.html             /faq                301
/contact_us.html      /contact            301

# --- Drop pages (no v1 equivalent — redirect to home as safe fallback) ---
/sitemap.html         /                   301
/benefits.html        /                   301

# --- Home (belt-and-suspenders) ---
/index.html           /                   301
```

If the crawl in Task 1 discovered ANY additional URLs not in the list above (e.g., old product subpages like `/kit-1.html`), add redirect rules for those as well:
- Old product subpages → `/products` (or `/products/[closest-slug]` if identifiable)
- Old image URLs → do NOT redirect (images will be re-hosted in Phase 3)

After writing the file, verify the build still passes:
```bash
cd /Users/carolyn/Gaslight && npm run build
```

Commit the redirect file:
```bash
cd /Users/carolyn/Gaslight && git add public/_redirects .planning/phases/01-foundation-and-content-audit/AUDIT.md && git commit -m "chore(01-02): add URL inventory audit and draft _redirects for all old HTML URLs"
git push
```
  </action>
  <verify>
    <automated>cd /Users/carolyn/Gaslight && test -f public/_redirects && grep -c "301" public/_redirects && npm run build 2>&1 | tail -3</automated>
    <manual>Count redirect rules in public/_redirects — should have at minimum 10 rules (one per known URL). Build should pass after adding the file.</manual>
    <sampling_rate>run after this task completes, before checkpoint</sampling_rate>
  </verify>
  <done>
    `public/_redirects` exists with at least 10 redirect rules (all known old HTML URLs covered). `npm run build` passes. Both files are committed and pushed to GitHub.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Carolyn reviews content audit and confirms photo/copy quality status</name>
  <files>
    .planning/phases/01-foundation-and-content-audit/AUDIT.md
  </files>
  <action>
Human reviews AUDIT.md content quality fields and fills in usable/needs-update/must-replace status for all product photos and copy. Also confirms domain expiry date and validates redirect rules. This is a human-only quality assessment — photo resolution and copy effectiveness cannot be evaluated programmatically.
  </action>
  <verify>
    <automated>grep -c "usable\|needs-update\|must-replace" /Users/carolyn/Gaslight/.planning/phases/01-foundation-and-content-audit/AUDIT.md</automated>
    <manual>
      Open `.planning/phases/01-foundation-and-content-audit/AUDIT.md`

      **For each product page (kits, bulbs, components):**
      1. Visit the old page in a browser (e.g., https://www.gaslightconversions.com/kits.html)
      2. Look at each photo listed in AUDIT.md. Mark each photo's Status as:
         - `usable` — resolution is good, image is clear, could use as-is on modern site
         - `needs-update` — image exists but is small, dark, or low quality — worth a retake or edit
         - `must-replace` — image is unusable (missing, corrupt, or completely wrong)
      3. Skim the product copy. Fill in Copy status as usable/needs-update/must-replace.

      **For the installation guide (/guide.html):**
      4. Skim the copy. Fill in Copy status.

      **Domain status:**
      5. If the domain expiry date is TBD in AUDIT.md, look up gaslightconversions.com at https://lookup.icann.org and fill in the expiry date and registrar.
      6. If expiry is within 60 days of your target launch, renew the domain NOW.

      **Redirect verification:**
      7. Scan `public/_redirects` — confirm each old URL you recognize has a sensible destination.
      8. If any old URLs are missing, add redirect rules manually.

      Save AUDIT.md when all status fields are filled in.
    </manual>
  </verify>
  <done>
    All photo Status and Copy status fields in AUDIT.md are filled in with usable/needs-update/must-replace. Domain expiry date is documented (not TBD). Redirect file has been reviewed and confirmed.
  </done>
  <resume-signal>
    Type "audit complete" when AUDIT.md is fully filled in, or describe any issues or missing items.
  </resume-signal>
</task>

</tasks>

<verification>
- AUDIT.md exists with all 10 URLs listed, HTTP status confirmed
- AUDIT.md has image URL rows with file sizes for kits, bulbs, and components pages
- AUDIT.md has copy excerpts for all product pages and guide page
- AUDIT.md has domain expiry date documented (not blank or TBD after checkpoint)
- All content quality status fields in AUDIT.md are filled in by Carolyn (usable/needs-update/must-replace)
- `public/_redirects` exists with at least 10 redirect rules
- `npm run build` passes with `public/_redirects` in place
</verification>

<success_criteria>
- Every URL on gaslightconversions.com is inventoried in AUDIT.md with HTTP status confirmed
- Every old HTML URL has a 301 redirect rule in `public/_redirects`
- Every product photo and copy block is marked usable/needs-update/must-replace by Carolyn
- Domain renewal date is documented — no surprise lapse risk
- MIGR-01, MIGR-02, and MIGR-03 are complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-content-audit/01-02-SUMMARY.md` using the summary template. Record: total URLs found, number of photos marked by status, copy quality summary, domain expiry date, any surprising URLs or issues discovered. Note whether any photos are marked must-replace (this gates Phase 3 asset production planning).
</output>
